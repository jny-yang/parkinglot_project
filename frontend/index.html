<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ParkingBot停車系統</title>
  <style>
    /* 保持原有樣式不變 */
  </style>
</head>
<body>
  <div class="container">
    <div>
      <h2 style="font-size: 2rem; text-align: center; color: #e2e8f0; margin-bottom: 15px;">停車場狀態</h2>
      <div class="parking-lot" id="parkingLot"></div>
    </div>
    <div class="control">
      <div class="screen" id="screen">請輸入車牌號碼</div>
      <input type="text" id="carId" placeholder="車牌號碼">
      <button class="park-btn" onclick="parkCar()">🚗 停車</button>
      <button class="retrieve-btn" onclick="retrieveCar()">⛔ 取車</button>
    </div>
  </div>

  <script>
    const gridSize = 3;  // 停車格數量設定為 3x3
    const lotDiv = document.getElementById('parkingLot');
    let carIcon;

    function createCar() {
      if (!carIcon) {
        carIcon = document.createElement('img');
        carIcon.src = "/static/car.png";  
        carIcon.className = "car";
        lotDiv.appendChild(carIcon);
      }
      carIcon.style.display = "block";
    }

    async function loadParkingLot() {
      let res = await fetch('/status');
      let data = await res.json();
      lotDiv.innerHTML = '';
      data.forEach((slot, i) => {
        let div = document.createElement('div');
        div.className = 'slot ' + (slot ? 'occupied' : 'empty');
        div.innerText = slot ? slot : i + 1;
        lotDiv.appendChild(div);
      });
      if (carIcon) lotDiv.appendChild(carIcon);
    }

    async function parkCar() {
      let carId = document.getElementById('carId').value;
      let res = await fetch('/park', {
        method: 'POST', 
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({plate: carId})  // 修改為 plate
      });
      let msg = await res.json();
      document.getElementById('screen').innerText = msg.message;
      if (msg.slots) {  // 這裡根據後端返回的結構
        createCar();
        // 這裡需要處理如何獲取 path，假設後端有提供
        // animateCar(msg.path, true);
      }
      loadParkingLot();
    }

    async function retrieveCar() {
      let carId = document.getElementById('carId').value;
      let res = await fetch('/take', {  // 修改為 /take
        method: 'POST', 
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({plate: carId})  // 修改為 plate
      });
      let msg = await res.json();
      document.getElementById('screen').innerText = msg.message;
      if (msg.slots) {  // 這裡根據後端返回的結構
        createCar();
        // 這裡需要處理如何獲取 path，假設後端有提供
        // animateCar(msg.path, false);
      }
      loadParkingLot();
    }

    function animateCar(path, parking = true) {
      // 動畫邏輯保持不變
    }

    loadParkingLot();
  </script>
</body>
</html>

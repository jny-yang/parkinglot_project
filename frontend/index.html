<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ParkingBotåœè»Šç³»çµ±</title>
  <style>
    /* ä¿æŒåŸæœ‰æ¨£å¼ä¸è®Š */
  </style>
</head>
<body>
  <div class="container">
    <div>
      <h2 style="font-size: 2rem; text-align: center; color: #e2e8f0; margin-bottom: 15px;">åœè»Šå ´ç‹€æ…‹</h2>
      <div class="parking-lot" id="parkingLot"></div>
    </div>
    <div class="control">
      <div class="screen" id="screen">è«‹è¼¸å…¥è»Šç‰Œè™Ÿç¢¼</div>
      <input type="text" id="carId" placeholder="è»Šç‰Œè™Ÿç¢¼">
      <button class="park-btn" onclick="parkCar()">ğŸš— åœè»Š</button>
      <button class="retrieve-btn" onclick="retrieveCar()">â›” å–è»Š</button>
    </div>
  </div>

  <script>
    const gridSize = 3;  // åœè»Šæ ¼æ•¸é‡è¨­å®šç‚º 3x3
    const lotDiv = document.getElementById('parkingLot');
    let carIcon;

    function createCar() {
      if (!carIcon) {
        carIcon = document.createElement('img');
        carIcon.src = "/static/car.png";  
        carIcon.className = "car";
        lotDiv.appendChild(carIcon);
      }
      carIcon.style.display = "block";
    }

    async function loadParkingLot() {
      let res = await fetch('/status');
      let data = await res.json();
      lotDiv.innerHTML = '';
      data.forEach((slot, i) => {
        let div = document.createElement('div');
        div.className = 'slot ' + (slot ? 'occupied' : 'empty');
        div.innerText = slot ? slot : i + 1;
        lotDiv.appendChild(div);
      });
      if (carIcon) lotDiv.appendChild(carIcon);
    }

    async function parkCar() {
      let carId = document.getElementById('carId').value;
      let res = await fetch('/park', {
        method: 'POST', 
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({plate: carId})  // ä¿®æ”¹ç‚º plate
      });
      let msg = await res.json();
      document.getElementById('screen').innerText = msg.message;
      if (msg.slots) {  // é€™è£¡æ ¹æ“šå¾Œç«¯è¿”å›çš„çµæ§‹
        createCar();
        // é€™è£¡éœ€è¦è™•ç†å¦‚ä½•ç²å– pathï¼Œå‡è¨­å¾Œç«¯æœ‰æä¾›
        // animateCar(msg.path, true);
      }
      loadParkingLot();
    }

    async function retrieveCar() {
      let carId = document.getElementById('carId').value;
      let res = await fetch('/take', {  // ä¿®æ”¹ç‚º /take
        method: 'POST', 
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({plate: carId})  // ä¿®æ”¹ç‚º plate
      });
      let msg = await res.json();
      document.getElementById('screen').innerText = msg.message;
      if (msg.slots) {  // é€™è£¡æ ¹æ“šå¾Œç«¯è¿”å›çš„çµæ§‹
        createCar();
        // é€™è£¡éœ€è¦è™•ç†å¦‚ä½•ç²å– pathï¼Œå‡è¨­å¾Œç«¯æœ‰æä¾›
        // animateCar(msg.path, false);
      }
      loadParkingLot();
    }

    function animateCar(path, parking = true) {
      // å‹•ç•«é‚è¼¯ä¿æŒä¸è®Š
    }

    loadParkingLot();
  </script>
</body>
</html>
